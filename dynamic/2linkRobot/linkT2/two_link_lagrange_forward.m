function [tao1,tao2] = two_link_lagrange_forward(q11,dq11,ddq11,q22,dq22,ddq22)
    global Ts pi g L1 L2 m1 m2 Ic11 Ic22 P01 P12 P23 Pc11 Pc22;
    R01 = hrotZ3x3(q11); R10 = R01';
    R12 = hrotX3x3(-pi/2)*hrotZ3x3(q22); R21 = R12';
    R23 = hrotX3x3(pi/2); R32 = R23';
    Ic11xx = Ic11(1,1); Ic11yy = Ic11(2,2); Ic11zz = Ic11(3,3);
    Ic11xy = -Ic11(1,2); Ic11xz = -Ic11(1,3); Ic11yz = -Ic11(2,3);
    Ic22xx = Ic22(1,1); Ic22yy = Ic22(2,2); Ic22zz = Ic22(3,3);
    Ic22xy = -Ic22(1,2); Ic22xz = -Ic22(1,3); Ic22yz = -Ic22(2,3);
    xc11 = Pc11(1); yc11 = Pc11(2); zc11 = Pc11(3);
    xc22 = Pc22(1); yc22 = Pc22(2); zc22 = Pc22(3);
    %tao1 = Ic11zz*ddq11 + (Ic22xx*ddq11)/2 + (Ic22yy*ddq11)/2 + ddq11*m1*xc11^2 + (ddq11*m2*xc22^2)/2 + ddq11*m1*yc11^2 + (ddq11*m2*yc22^2)/2 + ddq11*m2*zc22^2 - (Ic22xx*ddq11*cos(2*q22))/2 + (Ic22yy*ddq11*cos(2*q22))/2 + Ic22xz*dq22^2*cos(q22) - Ic22xy*ddq11*sin(2*q22) - Ic22yz*dq22^2*sin(q22) + Ic22yz*ddq22*cos(q22) + Ic22xz*ddq22*sin(q22) + (ddq11*m2*xc22^2*cos(2*q22))/2 - (ddq11*m2*yc22^2*cos(2*q22))/2 - 2*Ic22xy*dq11*dq22*cos(2*q22) + Ic22xx*dq11*dq22*sin(2*q22) - Ic22yy*dq11*dq22*sin(2*q22) + ddq22*m2*xc22*zc22*sin(q22) + dq22^2*m2*xc22*zc22*cos(q22) - ddq11*m2*xc22*yc22*sin(2*q22) - dq22^2*m2*yc22*zc22*sin(q22) - dq11*dq22*m2*xc22^2*sin(2*q22) + dq11*dq22*m2*yc22^2*sin(2*q22) + ddq22*m2*yc22*zc22*cos(q22) - 2*dq11*dq22*m2*xc22*yc22*cos(2*q22)+ L1^2*ddq11*m2  + 2*L1*ddq11*m2*zc22 + L1*dq22^2*m2*xc22*cos(q22) - L1*dq22^2*m2*yc22*sin(q22) + L1*ddq22*m2*yc22*cos(q22) + L1*ddq22*m2*xc22*sin(q22);
    %tao1 = Ic11zz*ddq11 + (Ic22xx*ddq11)/2 + (Ic22yy*ddq11)/2 + ddq11*m1*xc11^2 + (ddq11*m2*xc22^2)/2 + ddq11*m1*yc11^2 + (ddq11*m2*yc22^2)/2 + ddq11*m2*zc22^2 - (Ic22xx*ddq11*cos(2*q22))/2 + (Ic22yy*ddq11*cos(2*q22))/2 + Ic22xz*dq22^2*cos(q22) - Ic22xy*ddq11*sin(2*q22) - Ic22yz*dq22^2*sin(q22) + Ic22yz*ddq22*cos(q22) + Ic22xz*ddq22*sin(q22) + (ddq11*m2*xc22^2*cos(2*q22))/2 - (ddq11*m2*yc22^2*cos(2*q22))/2 - 2*Ic22xy*dq11*dq22*cos(2*q22) + Ic22xx*dq11*dq22*sin(2*q22) - Ic22yy*dq11*dq22*sin(2*q22) + ddq22*m2*xc22*zc22*sin(q22) + dq22^2*m2*xc22*zc22*cos(q22) - ddq11*m2*xc22*yc22*sin(2*q22) - dq22^2*m2*yc22*zc22*sin(q22) - dq11*dq22*m2*xc22^2*sin(2*q22) + dq11*dq22*m2*yc22^2*sin(2*q22) + ddq22*m2*yc22*zc22*cos(q22) - 2*dq11*dq22*m2*xc22*yc22*cos(2*q22);
     tao1 = Ic11zz*ddq11 + (Ic22xx*ddq11)/2 + (Ic22yy*ddq11)/2 + ddq11*m1*xc11^2 + (ddq11*m2*xc22^2)/2 + ddq11*m1*yc11^2 + (ddq11*m2*yc22^2)/2 + ddq11*m2*zc22^2 - (Ic22xx*ddq11*cos(2*q22))/2 + (Ic22yy*ddq11*cos(2*q22))/2 + Ic22xz*dq22^2*cos(q22) - Ic22xy*ddq11*sin(2*q22) - Ic22yz*dq22^2*sin(q22) + L1^2*ddq11*m2 + Ic22yz*ddq22*cos(q22) + Ic22xz*ddq22*sin(q22) + (ddq11*m2*xc22^2*cos(2*q22))/2 - (ddq11*m2*yc22^2*cos(2*q22))/2 - 2*Ic22xy*dq11*dq22*cos(2*q22) + Ic22xx*dq11*dq22*sin(2*q22) - Ic22yy*dq11*dq22*sin(2*q22) + 2*L1*ddq11*m2*zc22 + ddq22*m2*xc22*zc22*sin(q22) + L1*dq22^2*m2*xc22*cos(q22) - L1*dq22^2*m2*yc22*sin(q22) + dq22^2*m2*xc22*zc22*cos(q22) - ddq11*m2*xc22*yc22*sin(2*q22) - dq22^2*m2*yc22*zc22*sin(q22) - dq11*dq22*m2*xc22^2*sin(2*q22) + dq11*dq22*m2*yc22^2*sin(2*q22) + L1*ddq22*m2*yc22*cos(q22) + L1*ddq22*m2*xc22*sin(q22) + ddq22*m2*yc22*zc22*cos(q22) - 2*dq11*dq22*m2*xc22*yc22*cos(2*q22);
     tao2 = Ic22zz*ddq22 - dq22*((Ic22xz*dq11*cos(q22))/2 - (Ic22yz*dq11*sin(q22))/2) + ddq22*m2*xc22^2 + ddq22*m2*yc22^2 - m2*(dq11*(yc22*cos(q11)*cos(q22) + xc22*cos(q11)*sin(q22)) + dq22*sin(q11)*(xc22*cos(q22) - yc22*sin(q22)))*(dq11*(L1*sin(q11) + zc22*sin(q11) - xc22*cos(q11)*cos(q22) + yc22*cos(q11)*sin(q22)) + dq22*sin(q11)*(yc22*cos(q22) + xc22*sin(q22))) + m2*(dq11*(yc22*cos(q22)*sin(q11) + xc22*sin(q11)*sin(q22)) - dq22*cos(q11)*(xc22*cos(q22) - yc22*sin(q22)))*(dq11*(L1*cos(q11) + zc22*cos(q11) + xc22*cos(q22)*sin(q11) - yc22*sin(q11)*sin(q22)) + dq22*cos(q11)*(yc22*cos(q22) + xc22*sin(q22))) + dq11*cos(q22)*((Ic22xy*dq11*cos(q22))/2 + (Ic22yy*dq11*sin(q22))/2) - dq11*cos(q22)*((Ic22xz*dq22)/2 - (Ic22xy*dq11*cos(q22))/2 + (Ic22xx*dq11*sin(q22))/2) - dq11*sin(q22)*((Ic22xx*dq11*cos(q22))/2 + (Ic22xy*dq11*sin(q22))/2) + Ic22yz*ddq11*cos(q22) + dq11*sin(q22)*((Ic22yz*dq22)/2 + (Ic22yy*dq11*cos(q22))/2 - (Ic22xy*dq11*sin(q22))/2) + Ic22xz*ddq11*sin(q22) + g*m2*(xc22*cos(q22) - yc22*sin(q22)) + dq22^2*m2*(yc22*cos(q22) + xc22*sin(q22))*(xc22*cos(q22) - yc22*sin(q22)) + Ic22xz*dq11*dq22*cos(q22) - Ic22yz*dq11*dq22*sin(q22) + ddq11*m2*xc22*zc22*sin(q22) + L1*ddq11*m2*yc22*cos(q22) + L1*ddq11*m2*xc22*sin(q22) + ddq11*m2*yc22*zc22*cos(q22) + L1*dq11*dq22*m2*xc22*cos(q22) - L1*dq11*dq22*m2*yc22*sin(q22) + dq11*dq22*m2*xc22*zc22*cos(q22) - dq11*dq22*m2*yc22*zc22*sin(q22);
end

